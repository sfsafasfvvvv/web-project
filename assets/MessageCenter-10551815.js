import{_ as ae,u as oe,L as ne,r,c as S,o as le,w as ie,a as u,b as o,d as l,e,i,F as M,h as I,t as n,f as re,g as c,j as E,k as b,m as h,a2 as de,N as ce,a7 as D,E as P,q as J,a8 as ue,p as ve,a9 as pe,aa as _e,J as me,I as fe}from"./index-237fd1da.js";const he={class:"message-center"},ge={class:"container"},ye={class:"message-container"},we={class:"contact-list"},ke={class:"list-header"},Ce={class:"contact-items"},Se=["onClick"],be={class:"contact-avatar"},De={class:"avatar",style:{background:"#f5f5f5"}},Ve={class:"contact-info"},xe={class:"contact-header"},Me={class:"time"},Ie={class:"contact-preview"},Pe={key:0,class:"chat-window"},Te={class:"chat-header"},Ue={class:"user-info"},Be={class:"header-actions"},$e={class:"message-avatar"},Le={class:"avatar small",style:{background:"#f5f5f5"}},Ne={class:"message-content"},ze={class:"message-bubble"},Fe=["onClick"],Ee={class:"product-info"},Je={class:"price"},Ke={key:1,class:"image-message"},Oe=["onClick"],Re={key:2},He={class:"message-time"},je={key:0,class:"loading-messages"},qe={class:"chat-input"},Ae={class:"input-toolbar"},We={class:"input-area"},Ye={key:1,class:"empty-state"},Ge={class:"product-list"},Qe=["onClick"],Xe={class:"product-info"},Ze={class:"price"},et={class:"status"},tt={__name:"MessageCenter",setup(st){const T=oe(),U=ne(),B=r(null),g=r(""),_=r(""),K=r(!1),V=r(!1),y=r(!1),x=r(!1),d=r(null),O=S(()=>{var s;return(s=U.user)==null?void 0:s.username});S(()=>{var s;return(s=U.user)==null?void 0:s.avatar});const $=r([{id:1,username:"John Doe",avatar:"",online:!0,unreadCount:2,productId:1,lastMessage:{content:"Is this item still available?",time:new Date(Date.now()-1e3*60*30)}},{id:2,username:"Jane Smith",avatar:"",online:!1,unreadCount:0,productId:2,lastMessage:{content:"Can we meet tomorrow?",time:new Date(Date.now()-1e3*60*60)}}]),w=r([{id:1,content:"Hi, is this item still available?",time:new Date(Date.now()-1e3*60*60),type:"text",isSelf:!1},{id:2,content:"Yes, it is still available.",time:new Date(Date.now()-1e3*60*30),type:"text",isSelf:!0},{id:3,type:"product",product:{id:1,title:"iPhone 12",price:599,cover:""},time:new Date(Date.now()-1e3*60*20),isSelf:!0}]),R=r([{id:1,title:"iPhone 12",price:599,status:"active",cover:""},{id:2,title:"MacBook Pro",price:1299,status:"sold",cover:""}]),H=S(()=>{if(!g.value)return $.value;const s=g.value.toLowerCase();return $.value.filter(a=>a.username.toLowerCase().includes(s))}),j=S(()=>d.value?w.value:[]),q=s=>{d.value=s,D(()=>{m()})},L=async()=>{if(_.value.trim())try{V.value=!0,await new Promise(s=>setTimeout(s,500)),w.value.push({id:Date.now(),content:_.value,time:new Date,type:"text",isSelf:!0}),_.value="",D(()=>{m()})}catch(s){console.error("Failed to send message:",s),P.error("Failed to send message, please try again")}finally{V.value=!1}},A=s=>{w.value.push({id:Date.now(),content:s.url,time:new Date,type:"image",isSelf:!0}),D(()=>{m()})},W=s=>{const a=s.type.startsWith("image/"),k=s.size/1024/1024<2;return a?k?!0:(P.error("Image size cannot exceed 2MB"),!1):(P.error("Only image files are allowed"),!1)},Y=()=>{y.value=!0},G=s=>{w.value.push({id:Date.now(),type:"product",product:s,time:new Date,isSelf:!0}),y.value=!1,D(()=>{m()})},N=s=>{T.push(`/product/${s}`)},Q=s=>{x.value=!0},m=()=>{const s=B.value;s&&(s.scrollTop=s.scrollHeight)},z=s=>{if(!s)return"";try{return me(new Date(s),{addSuffix:!0,locale:fe})}catch{return console.error("Invalid time:",s),""}},X=s=>({active:"Active",sold:"Sold",removed:"Removed"})[s]||s;return le(()=>{m()}),ie(d,()=>{}),(s,a)=>{const k=u("el-input"),Z=u("el-badge"),f=u("el-button"),ee=u("el-icon"),te=u("el-upload"),se=u("el-empty"),F=u("el-dialog");return o(),l("div",he,[e("div",ge,[e("div",ye,[e("div",we,[e("div",ke,[a[5]||(a[5]=e("h2",null,"Messages",-1)),i(k,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=t=>g.value=t),placeholder:"Search contacts...","prefix-icon":"Search",clearable:""},null,8,["modelValue"])]),e("div",Ce,[(o(!0),l(M,null,I(H.value,t=>{var v;return o(),l("div",{key:t.id,class:J(["contact-item",{active:((v=d.value)==null?void 0:v.id)===t.id}]),onClick:p=>q(t)},[e("div",be,[i(Z,{value:t.unreadCount,hidden:!t.unreadCount},{default:c(()=>{var p,C;return[e("div",De,n((C=(p=t.username)==null?void 0:p[0])==null?void 0:C.toUpperCase()),1)]}),_:2},1032,["value","hidden"])]),e("div",Ve,[e("div",xe,[e("h3",null,n(t.username),1),e("span",Me,n(z(t.lastMessage.time)),1)]),e("div",Ie,[e("p",null,n(t.lastMessage.content),1)])])],10,Se)}),128))])]),d.value?(o(),l("div",Pe,[e("div",Te,[e("div",Ue,[e("h2",null,n(d.value.username),1),e("p",null,n(d.value.online?"Online":"Offline"),1)]),e("div",Be,[d.value.productId?(o(),re(f,{key:0,type:"primary",link:"",onClick:N},{default:c(()=>a[6]||(a[6]=[b(" View Product ")])),_:1})):E("",!0)])]),e("div",{class:"chat-messages",ref_key:"messageContainer",ref:B},[(o(!0),l(M,null,I(j.value,t=>{var v,p;return o(),l("div",{key:t.id,class:J(["message-item",{"message-self":t.isSelf}])},[e("div",$e,[e("div",Le,n((p=(v=t.isSelf?O.value:d.value.username)==null?void 0:v[0])==null?void 0:p.toUpperCase()),1)]),e("div",Ne,[e("div",ze,[t.type==="product"?(o(),l("div",{key:0,class:"product-message",onClick:C=>N(t.product.id)},[a[7]||(a[7]=e("div",{class:"product-cover",style:{background:"#f5f5f5"}},null,-1)),e("div",Ee,[e("h4",null,n(t.product.title),1),e("p",Je,"$"+n(t.product.price),1)])],8,Fe)):t.type==="image"?(o(),l("div",Ke,[e("div",{class:"image-preview",style:{background:"#f5f5f5"},onClick:C=>Q(t.content)},null,8,Oe)])):(o(),l("p",Re,n(t.content),1))]),e("span",He,n(z(t.time)),1)])],2)}),128)),K.value?(o(),l("div",je,[i(ee,{class:"is-loading"},{default:c(()=>[i(h(ue))]),_:1}),a[8]||(a[8]=b(" Loading more messages... "))])):E("",!0)],512),e("div",qe,[e("div",Ae,[i(te,{action:"/api/upload","show-file-list":!1,"on-success":A,"before-upload":W},{default:c(()=>[i(f,{icon:h(ve)},null,8,["icon"])]),_:1}),i(f,{icon:h(pe),onClick:Y},null,8,["icon"])]),e("div",We,[i(k,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=t=>_.value=t),type:"textarea",rows:3,placeholder:"Type a message...",resize:"none",onKeyup:de(ce(L,["prevent"]),["enter"])},null,8,["modelValue","onKeyup"]),i(f,{type:"primary",icon:h(_e),onClick:L,loading:V.value},{default:c(()=>a[9]||(a[9]=[b(" Send ")])),_:1},8,["icon","loading"])])])])):(o(),l("div",Ye,[i(se,{description:"Select a contact to start chatting"},{default:c(()=>[i(f,{type:"primary",onClick:a[2]||(a[2]=t=>h(T).push("/"))},{default:c(()=>a[10]||(a[10]=[b(" Browse Products ")])),_:1})]),_:1})]))])]),i(F,{modelValue:y.value,"onUpdate:modelValue":a[3]||(a[3]=t=>y.value=t),title:"Select Product to Share",width:"600px"},{default:c(()=>[e("div",Ge,[(o(!0),l(M,null,I(R.value,t=>(o(),l("div",{key:t.id,class:"product-item",onClick:v=>G(t)},[a[11]||(a[11]=e("div",{class:"product-cover",style:{background:"#f5f5f5"}},null,-1)),e("div",Xe,[e("h4",null,n(t.title),1),e("p",Ze,"$"+n(t.price),1),e("p",et,n(X(t.status)),1)])],8,Qe))),128))])]),_:1},8,["modelValue"]),i(F,{modelValue:x.value,"onUpdate:modelValue":a[4]||(a[4]=t=>x.value=t)},{default:c(()=>a[12]||(a[12]=[e("div",{class:"preview-image",style:{background:"#f5f5f5",width:"100%",height:"400px",borderRadius:"var(--radius-lg)"}},null,-1)])),_:1},8,["modelValue"])])}}},ot=ae(tt,[["__scopeId","data-v-317911a5"]]);export{ot as default};
